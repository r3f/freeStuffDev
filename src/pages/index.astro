---
import { getCollection } from 'astro:content'
import Layout from '../layouts/Layout.astro'
import Card from '../components/Card.astro'
import Header from '../components/Header.astro'
import Sponsors from '../components/Sponsors.astro'

// è·å–æ‰€æœ‰å·¥å…·é›†åˆï¼Œéä»˜è´¹
const tools = await getCollection('tools', ({data}) => {
	return data.isPaid !== true
})

// éšæœºåŒ–åˆ—è¡¨
tools.sort(() => Math.random() - 0.5)

const title="å…è´¹çš„å¼€å‘è€…å·¥å…·å’ŒæœåŠ¡"
const description="ç”±å¼€å‘è€…ä¸ºå¼€å‘è€…æä¾›çš„å…è´¹å·¥å…·åˆ—è¡¨ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„æœåŠ¡é›†åˆï¼Œå¯ç”¨äºæ‚¨çš„ä¸‹ä¸€ä¸ª MVP æˆ–åŸå‹è®¾è®¡ã€‚"

---

<Layout
	title={title}
	description={description}
	>

	<Header
		title={title}
		description={description}
		/>

	<Sponsors />

	<p class="text-xl mb-3">å…è´¹å¼€å‘å·¥å…· ğŸ‘‡ğŸ¼</p>
	

	<div class="flex justify-between items-center space-x-5">
		<div class="w-full">
			<input 
				class="bg-gray-700 text-white text-sm rounded-md w-full border border-white p-2"
				type="text"
				placeholder="åœ¨æ­¤æœç´¢ä»»ä½•å†…å®¹..."
				id="searchbox">
		</div>

			
		<div class="flex justify-end items-center w-[200px]">
			<label for="sort" class="text-sm">æ’åºæ–¹å¼ï¼š</label>
			<select id="sort" 
				class="bg-gray-800 text-white text-sm rounded-md ml-2 border border-white p-2">
				<option value="random">éšæœº</option>
				<option value="newest">æœ€æ–°</option>
			</select>

			<script>
				document.getElementById('sort')?.addEventListener('change', (e) => {
					if(!e.target) return

					const sort = (e.target as any).value
					if (sort === 'newest') {
						location.href = '/recent'
					} else {
						location.href = '/'
					}
				})
			</script>
		</div>
	</div>

	<div class="mt-10">
		{
			tools.map((tool) => (
				<Card tool={tool} />
			))
		}
	</div>

	<!-- é‡è¦æç¤ºï¼šä½ç½®åœ¨å¡ç‰‡ä¹‹å -->
	<script is:inline>
		function initSearch() {
			const cards = document.querySelectorAll('.cards')
			// ç¨ä½œå»¶è¿Ÿ
			let typingTimer;        
			let typeInterval = 500; // åŠç§’
			let searchInput = document.getElementById('searchbox');

			searchInput.addEventListener('keyup', () => {
				clearTimeout(typingTimer);
				typingTimer = setTimeout(liveSearch, typeInterval);
			});
			
			function liveSearch() {
				const searchQ = searchInput.value
				for (var i = 0; i < cards.length; i++) {
					if(cards[i].textContent.toLowerCase()
							.includes(searchQ.toLowerCase())) {
						cards[i].classList.remove("hidden");
					} else {
						cards[i].classList.add("hidden");
					}
				}
			}
		}
		
		document.addEventListener('DOMContentLoaded', initSearch)
		document.addEventListener('astro:after-swap', initSearch)
	</script>

</Layout>
